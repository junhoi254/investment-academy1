# 🔄 업데이트 내역 - 투자학당 v2.0.0

## 🎉 주요 변경사항

### 1️⃣ 앱 이름 변경
- **이전**: 리딩방 / Trading Chat
- **변경**: 투자학당 / Investment Academy
- 모든 UI와 문서에서 "투자학당" 사용

### 2️⃣ 관리자 이름 변경
- **최고 관리자**: "일타훈장님" 👨‍🏫
- **기본 계정**: 010-0000-0000 / admin1234
- 채팅방에서 "일타훈장님" 뱃지 표시

### 3️⃣ 서브 관리자 시스템
- **기존 "직원"** → **"서브관리자"**로 명칭 변경
- 서브관리자도 채팅방에서 메시지 작성 가능
- 일타훈장님이 서브관리자 생성 가능
- 채팅 권한: 일타훈장님 + 서브관리자만

### 4️⃣ 파일 업로드 기능 ⭐
- **이미지 업로드**: JPG, PNG, GIF, WEBP (최대 5MB)
- **파일 업로드**: PDF, DOC, DOCX, XLS, XLSX, TXT, ZIP (최대 10MB)
- 채팅방에서 📎 버튼으로 파일 업로드
- 채팅방에서 🖼️ 버튼으로 이미지 업로드
- 업로드된 파일은 클릭하여 다운로드
- 이미지는 채팅방에서 바로 미리보기

### 5️⃣ 이모티콘 기능 ⭐
- **100+ 이모티콘** 지원
- 😊 버튼으로 이모티콘 선택기 열기
- 감정, 제스처, 하트, 아이콘 등 다양한 카테고리
- 메시지에 이모티콘 추가 가능

## 📝 상세 변경 내용

### Backend 변경사항

#### 1. 파일 업로드 API 추가
```python
POST /api/upload/image  # 이미지 업로드
POST /api/upload/file   # 파일 업로드
GET /uploads/{filename} # 파일 다운로드
```

#### 2. 데이터베이스 스키마 업데이트
- `Message` 모델에 `file_url`, `file_name` 필드 추가
- 메시지 타입에 `image`, `file`, `emoji` 추가

#### 3. 보안 강화
- 파일 확장자 검증
- 파일 크기 제한
- 고유 파일명 생성 (UUID)

### Frontend 변경사항

#### 1. ChatRoom 컴포넌트 대폭 업그레이드
- 파일 업로드 버튼 (📎)
- 이미지 업로드 버튼 (🖼️)
- 이모티콘 선택기 (😊)
- 이미지 미리보기
- 파일 다운로드 링크

#### 2. UI/UX 개선
- 업로드 버튼 스타일링
- 이모티콘 피커 디자인
- 메시지 타입별 렌더링
- 로딩 상태 표시

#### 3. 역할 표시 업데이트
- 관리자 → 일타훈장님
- 직원 → 서브관리자
- 모든 컴포넌트에서 일관된 표시

## 💡 사용 시나리오

### 시나리오 1: 차트 분석 공유
```
1. 일타훈장님이 차트를 캡처
2. 🖼️ 버튼으로 이미지 업로드
3. 모든 회원이 실시간으로 확인
4. "진입 타이밍입니다 👍" 메시지 추가
```

### 시나리오 2: 투자 전략 문서 공유
```
1. 서브관리자가 투자 전략 PDF 작성
2. 📎 버튼으로 파일 업로드
3. 회원들이 다운로드하여 학습
4. "감사합니다 🙏" 이모티콘 반응
```

### 시나리오 3: MT4 자동 시그널 + 이모티콘
```
1. MT4에서 포지션 진입
2. 자동으로 채팅방에 시그널 전송
3. 일타훈장님: "좋은 타이밍이네요 👌"
4. 서브관리자: "진입 완료 💪"
```

## 🎯 권한 체계

### 메시지 작성 권한
| 역할 | 텍스트 | 이미지 | 파일 | 이모티콘 |
|------|--------|--------|------|----------|
| 일타훈장님 | ✅ | ✅ | ✅ | ✅ |
| 서브관리자 | ✅ | ✅ | ✅ | ✅ |
| 일반 회원 | ❌ | ❌ | ❌ | ❌ |

### 관리 권한
| 기능 | 일타훈장님 | 서브관리자 |
|------|-----------|-----------|
| 회원 승인 | ✅ | ❌ |
| 비밀번호 변경 | ✅ | ❌ |
| 회원 기간 설정 | ✅ | ❌ |
| 서브관리자 생성 | ✅ | ❌ |
| 채팅방 생성 | ✅ | ❌ |
| 채팅 작성 | ✅ | ✅ |

## 🔧 기술 개선사항

### 1. 파일 저장 시스템
- 로컬 파일 시스템 사용 (`/uploads` 디렉토리)
- UUID 기반 고유 파일명
- FastAPI StaticFiles로 서빙

### 2. 메시지 타입 확장
```python
message_type: "text" | "image" | "file" | "signal" | "system"
```

### 3. 프론트엔드 상태 관리
- 업로드 중 로딩 상태
- 이모티콘 선택기 토글
- 파일 입력 참조 (useRef)

## 📦 업그레이드 방법

### 기존 사용자

```bash
# 1. 백업
cp -r trading-chat trading-chat-backup

# 2. 새 버전 다운로드
tar -xzf trading-chat-v2.0.tar.gz

# 3. 데이터베이스 마이그레이션
cd trading-chat/backend
python main.py  # 자동으로 새 컬럼 추가됨

# 4. 재시작
./start.sh
```

### 새로운 사용자

```bash
tar -xzf trading-chat-v2.0.tar.gz
cd trading-chat
./start.sh
```

## 🐛 버그 수정

- ✅ WebSocket 재연결 안정성 개선
- ✅ 메시지 스크롤 자동 이동 최적화
- ✅ 파일 업로드 오류 처리 강화

## 🎨 UI/UX 개선

- 새로운 업로드 버튼 디자인
- 이모티콘 피커 애니메이션
- 이미지 미리보기 호버 효과
- 파일 다운로드 아이콘

## 📱 모바일 앱 개선

- Capacitor 설정 업데이트
- 앱 이름: "투자학당"
- 앱 ID: com.investmentacademy.app

## ⚠️ 주의사항

1. **데이터베이스**: 기존 데이터는 유지되지만 새 컬럼이 추가됩니다
2. **파일 저장소**: `/uploads` 디렉토리 권한 확인 필요
3. **서버 용량**: 파일 업로드로 인한 디스크 사용량 증가 모니터링

## 🎉 다음 업데이트 계획 (v2.1)

- [ ] 음성 메시지
- [ ] 동영상 공유
- [ ] 스티커팩
- [ ] 알림 설정
- [ ] 다크 모드

---

**버전**: 2.0.0  
**릴리즈 날짜**: 2026-01-14  
**개발**: 투자학당 팀  
**관리**: 일타훈장님 👨‍🏫
